---
title: 记录某轻小说网站字符混淆解码过程
date: 2023-8-20 09:30:21
cover: /img/assets/
thumbnail: /img/assets/
categories: 
- 编程
tags:
- 图书
toc: true
---

最近经常在哔哩轻小说上看书，想做一个爬虫制作成 Epub 文件，在 Apple Books 上阅读，网站html源码整体很好解析，但是文本内容针对特定字符做了替换，需要找到js代码中的字符对照表，才能解密。

## js定位

## 利用Claude尝试阅读加密js源码

## 原理分析

通过 utf-8 将操作的 js 代码转换为一串数字，然后每隔两个字符中添加一个字母，这一段字符串就是需要解密的程序。

## 字符表提取程序

```Python
def decrypt_string(encrypted_string):
	decrypted = ""
	num_str = ""
	
	for char in encrypted_string:
		if char.isalpha():
			if num_str:
				num = int(num_str)
				if num <= 128:
					decrypted += chr(num) 
				else:
					decrypted += str(num)
				num_str = ""
		else:
			num_str += char
			
	return decrypted

decrypted_string = decrypt_string(encode_text)
decoded_string = decrypted_string.encode('utf-8').decode('unicode-escape')
table = []

for line in decoded_string.split('.'):
	if 'replace' in line:
		matches = re.findall(r'"(.*?)"|\'(.*?)\'', line)
		row = [matches[0][0] if matches[0][0] != '' else matches[0][1], matches[2][0] if matches[2][0] != '' else matches[2][1]]
		row[0] = chr(int(row[0]))
		if len(row[1]) > 2:
			row[1] = chr(int(row[1]))
		print(row)
```


## 总结